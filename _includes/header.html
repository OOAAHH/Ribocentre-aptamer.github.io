<div class="navbar-expand-lg navbar-dark"
  style='background-color: #333333; border-radius: 0; margin-bottom: 0; border: 0; height: 30px;' role="navigation">
  <div class="container-fluidmiao" style='height: 30px; max-width: 1000px;'>
    <ul class="nav navbar-nav navbar-right" style='height: 30px;'>
      <li><a style='display: inline; padding: 15px 15px 5px 5px; line-height: 30px;' class="nav-link-0"
          href="https://www.gznl.org/">
          <img src="{{ site.url }}{{ site.baseurl }}/images/header/home.svg"
            style='height: 20px; width: auto; margin: 0;'>
          Home</a></li>
      <li><a style='display: inline; padding: 15px 15px 5px 5px; line-height: 30px;' class="nav-link-0"
          href="https://www.gznl.org/database/">
          <img src="{{ site.url }}{{ site.baseurl }}/images/header/database.svg"
            style='height: 20px; width: auto; margin: 0;'>
          Database</a></li>
      <li><a style='display: inline; padding: 15px 15px 5px 5px; line-height: 30px;' class="nav-link-0"
          href="https://www.gznl.org/research/">
          <img src="{{ site.url }}{{ site.baseurl }}/images/header/research.svg"
            style='height: 20px; width: auto; margin: 0;'>
          Research</a></li>
      <li><a style='display: inline; padding: 15px 15px 5px 5px; line-height: 30px;' class="nav-link-0"
          href="https://www.gznl.org/aboutus/">
          <img src="{{ site.url }}{{ site.baseurl }}/images/header/aboutus.svg"
            style='height: 20px; width: auto; margin: 0;'>
          About us</a></li>
      <li><a style='display: inline; padding: 15px 15px 5px 5px; line-height: 30px;' class="nav-link-0"
          href="javascript:void(0);" onclick="document.getElementById('search-box-header').focus();">
          <img src="{{ site.url }}{{ site.baseurl }}/images/header/search.svg"
            style='height: 20px; width: auto; margin: 0;'>
          Search</a></li>
      <li><a style='display: inline; padding: 15px 15px 5px 5px; line-height: 30px;' class="nav-link-0"
          href="https://gzlab.ac.cn/">
          GZNL-RDC
          <img src="{{ site.url }}{{ site.baseurl }}/images/header/gznl2.svg"
            style='height: 20px; width: auto; margin: 0;'>
        </a></li>
    </ul>
  </div>
</div>

<!--
	<div class="search-container">
	  <p class="search-text">Search for something:</p>
	  <div class="search-box">
		<input type="text" placeholder="Search...">
	  </div>
	  <p class="additional-text">Additional text here...</p>
	</div>

	<div class="background-image">
	  <img src="{{ site.url }}{{ site.baseurl }}/images/Picture-1.jpg" style='width: 100%; border-radius: 0; margin-top: 0; margin-bottom: 0;'>
	</div>
  -->

<!--div class="full-width-image">
	<img src="{{ site.url }}{{ site.baseurl }}/images/homepicture2.jpeg" class="img-fluid" alt="Responsive image" style='width: 100%; border-radius: 0; margin-top: 0; margin-bottom: 0;'>
  </div-->

<!--div class="full-width-image">
	<img src="{{ site.url }}{{ site.baseurl }}/images/homepicture2.jpeg" class="img-fluid" alt="Responsive image" style='width: 100%; border-radius: 0; margin-top: 0; margin-bottom: 0;'>
  </div-->
<!--style>
	/* This sets the container for the image */
	.full-width-image {
            width: 100%; /* Full width */
            height: 300px; /* Fixed height */
            overflow: hidden; /* Hides overflow to prevent unwanted scrollbars */
			border-radius: 0;
            margin-top: 0;
            margin-bottom: 0;
        }

        /* This sets the style for the image */
        .full-width-image img {
            width: 100%; /* Full width of the container */
            height: 100%; /* Full height of the container */
            object-fit: cover; /* Maintains aspect ratio while filling the space */
            object-position: center; /* Centers the image if it needs to be cropped */
        }
</style-->






<div class="full-width-image">
  <div class="search-box">
    <div class="search">
      <h1>GZNL's Respiratory Data Centre, GZNL-RDC</h1>
      <div class="i"><img src="/images/logo.svg">
        <h1><b>Ribocentre-aptamer</b></h1>
      </div>
      <p>A database of RNA aptamers</p>

      <!-- Google 风格搜索框 -->
      <!-- Google 风格搜索框 -->
      <div class="google-search-container" style="width: 100%; max-width: 100%;">
        <div class="search-input-container">
          <!-- 将按钮移到输入框前面 -->
          <div class="search-icon" id="search-button-header">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="#9aa0a6" class="bi bi-search"
              viewBox="0 0 16 16">
              <path
                d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z" />
            </svg>
          </div>
          <input type="text" id="search-box-header" class="google-search-input" placeholder="Search RNA aptamers..."
            aria-label="Search keywords" autocomplete="off">
        </div>
        <div class="search-results-wrapper" style="position: relative; width: 100%;">
          <div id="search-results-header" class="search-results-container" style="display: none;"></div>
        </div>
      </div>

      <p>Example:
        <a class="tip" href="{{ site.url }}{{ site.baseurl }}/Ribocentre-aptamer/">RNA aptamer</a>&nbsp;&nbsp;
        <a class="tip" href="{{ site.url }}{{ site.baseurl }}/SELEX/">SELEX</a>&nbsp;&nbsp;
        <a class="tip" href="{{ site.url }}{{ site.baseurl }}/_posts/ATP-aptamer/" target="_blank">ATP aptamer</a>&nbsp;&nbsp;
        <a class="tip" href="{{ site.url }}{{ site.baseurl }}/structures/">Structure</a>&nbsp;&nbsp;
      </p>
    </div>
  </div>
</div>


<style>
  .full-width-image {
    width: 100%;
    height: 350px;
    overflow: hidden;
    border-radius: 0;
    margin-top: 0;
    margin-bottom: 0;
    position: relative;
    background: url(../../images/homepicture2.jpeg) no-repeat;
    background-size: cover;
    /* 使用 cover 让背景图片填充整个容器 */
    background-position: center;
    /* 让背景图片在容器中水平和垂直居中 */
  }

  .full-width-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center
  }

  .search-box {
    height: 100%;
    width: 72%;
    margin: 0 auto;
    display: flex;
    align-items: center
  }

  .search {
    padding-top: 0px;
    padding-bottom: 0px;
    padding-left: 20px;
    padding-right: 20px;
    background: #fff;
    position: absolute;
    width: 100%;
    max-width: 600px;
  }

  .search h1 {
    font-size: 20px
  }

  .search .i {
    display: flex;
    align-items: center
  }

  .search .i img {
    width: 70px;
    /*height: 70px;*/
    object-fit: contain
  }

  .search .i h1 {
    font-size: 28px;
    font-weight: 700px;
    margin-left: 10px
  }

  .search .tip {
    font-size: 14px;
    margin-top: 10px
  }

  .searchInput {
    margin-top: 10px;
    width: 450px;
    height: 32px;
    display: flex
  }

  .searchInput input {
    flex: 1;
    height: 100%;
    line-height: 32px;
    border: 1px solid #868686;
    outline: 0;
    border-radius: 7px;
    padding: 0 10px
  }

  .gsc-control {
    width: 300px;
  }

  .gsc-control div {
    position: static;
  }

  .gsc-control-cse {
    padding: 1em;
  }

  .gsc-control-cse,
  .gsc-control-cse .gsc-table-result {
    width: auto;
    font-family: Arial, sans-serif;
    font-size: 13px;
  }

  .gsc-control-wrapper-cse {
    width: 600px;
  }

  .gsc-search-button-v2,
  .gsc-search-button-v2:hover,
  .gsc-search-button-v2:focus {
    border-color: #520049;
    background-color: #520049;
    background-image: none;
    filter: none;
    border-radius: 1px;
  }

  .gsc-search-button-v2 {
    font-size: 0;
    padding: 8px 27px;
    width: auto;
    vertical-align: middle;
    border: 1px solid #666;
    border-radius: 1px;
  }

  .gsc-control-cse,
  .gsc-control-cse .gsc-table-result {
    width: auto;
    font-family: Arial, sans-serif;
    font-size: 1px;
  }

  .gsc-input {
    font-size: 16px;
    color: #000000;
    font-weight: normal;
  }

  .gsc-control-cse {
    background-color: #fff;
    border: 1px solid #fff;
  }

  .gsc-input-box {
    border: 2px solid #cccccc;
    background: #fff;
  }

  table:not(.table-bordered)>thead>tr>th,
  table:not(.table-bordered)>tbody>tr>th,
  table:not(.table-bordered)>tfoot>tr>th,
  table:not(.table-bordered)>thead>tr>td,
  table:not(.table-bordered)>tbody>tr>td,
  table:not(.table-bordered)>tfoot>tr>td,
  .table:not(.table-bordered)>thead>tr>th,
  .table:not(.table-bordered)>tbody>tr>th,
  .table:not(.table-bordered)>tfoot>tr>th,
  .table:not(.table-bordered)>thead>tr>td,
  .table:not(.table-bordered)>tbody>tr>td,
  .table:not(.table-bordered)>tfoot>tr>td {
    border-color: transparent;
    border: 1px solid #ffffff;
  }

  /* 自定义搜索框样式 */
  .custom-search-container {
    position: relative !important;
    width: 100% !important;
    z-index: 999999 !important;
  }

  .custom-search-container .input-group {
    max-width: 600px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    border-radius: 4px;
    overflow: hidden;
  }

  .custom-search-container .form-control {
    border: 1px solid #ced4da;
    padding: 8px 15px;
    font-size: 16px;
    height: 40px;
  }

  .custom-search-container .btn-primary {
    background-color: #520049;
    border-color: #520049;
    padding: 8px 15px;
    border-radius: 0 4px 4px 0;
  }

  .custom-search-container .btn-primary:hover {
    background-color: #3d0037;
    border-color: #3d0037;
  }

  .custom-search-container svg {
    color: white;
  }

  /* 搜索结果容器样式 */
  .search-results-wrapper {
    position: absolute;
    top: 44px;
    left: 0;
    width: 100%;
    z-index: 999999;
    margin-top: 5px;
  }

  .search-results-container {
    position: relative !important;
    width: 100% !important;
    max-width: 100% !important;
    background-color: white !important;
    border-radius: 8px !important;
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.25) !important;
    z-index: 999999 !important;
    margin-top: 5px !important;
    max-height: 400px !important;
    overflow-y: auto !important;
  }

  /* 搜索结果项目样式 */
  .search-result-item {
    padding: 15px !important;
    border-bottom: 1px solid #eee !important;
    cursor: pointer !important;
    display: flex !important;
    flex-direction: column !important;
    transition: background-color 0.2s ease;
  }

  .search-result-item:last-child {
    border-bottom: none !important;
  }

  .search-result-item:hover {
    background-color: #f8f9fa !important;
  }

  .search-result-item h4 {
    margin: 0 0 5px 0;
    color: #1a73e8;
    font-size: 18px;
    font-weight: 500;
  }

  .search-result-item h4 a {
    color: #1a73e8;
    text-decoration: none;
  }

  .search-result-item h4 a:hover {
    text-decoration: underline;
  }

  .search-result-item p {
    margin: 5px 0 0 0;
    color: #4d5156;
    font-size: 14px;
    line-height: 1.58;
  }

  .search-result-item .category {
    color: #70757a;
    font-size: 12px;
    margin-bottom: 5px;
  }

  .search-result-item .tags {
    color: #520049;
    font-size: 12px;
  }

  .search-result-item .content-preview {
    margin: 5px 0;
    color: #4d5156;
    font-size: 14px;
    line-height: 1.58;
    overflow: hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
  }

  .search-result-meta {
    display: flex;
    justify-content: space-between;
    margin-top: 5px;
    font-size: 12px;
    color: #70757a;
  }

  .search-result-date {
    color: #70757a;
  }

  .no-results-message {
    padding: 20px !important;
    text-align: center !important;
    color: #4d5156 !important;
    font-size: 16px !important;
  }

  .result-count {
    padding: 10px 15px;
    border-bottom: 1px solid #eee;
    color: #70757a;
    font-size: 14px;
  }

  /* 加载状态样式 */
  .loading-message {
    padding: 15px;
    text-align: center;
    color: #666;
  }

  .loading-message:after {
    content: "...";
    animation: dots 1.5s steps(5, end) infinite;
  }

  @keyframes dots {

    0%,
    20% {
      content: ".";
    }

    40% {
      content: "..";
    }

    60%,
    100% {
      content: "...";
    }
  }

  /* 自定义滚动条 */
  .search-results-container::-webkit-scrollbar {
    width: 8px;
  }

  .search-results-container::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 8px;
  }

  .search-results-container::-webkit-scrollbar-thumb {
    background: #888;
    border-radius: 8px;
  }

  .search-results-container::-webkit-scrollbar-thumb:hover {
    background: #555;
  }

  /* Google 风格搜索框样式 */
  /* Google 风格搜索框样式 */
  .google-search-container {
    position: relative;
    width: 100%;
    max-width: 100%;
    margin-bottom: 20px;
    background: transparent;
    z-index: 999999;
  }

  .search-input-container {
    display: flex;
    width: 100%;
    position: relative;
    align-items: center;
    background-color: white;
    border: 1px solid #dfe1e5;
    border-radius: 24px;
    box-shadow: 0 1px 6px rgba(32, 33, 36, 0.28);
    height: 44px;
  }

  .search-input-container:hover,
  .search-input-container:focus-within {
    box-shadow: 0 1px 6px rgba(32, 33, 36, 0.38);
    border-color: rgba(223, 225, 229, 0);
  }

  /* 左侧搜索图标样式 */
  .search-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0 14px;
    cursor: pointer;
  }

  /* 搜索输入框样式 */
  .google-search-input {
    flex: 1;
    height: 100%;
    border: none;
    outline: none;
    font-size: 16px;
    background: transparent;
    width: 100%;
    padding: 0 16px 0 0;
    margin-bottom: 0;
  }

  /* 隐藏旧的搜索按钮 */
  .google-search-button {
    display: none;
  }

  .search-results-wrapper {
    position: absolute;
    top: 100%;
    left: 0;
    width: 100%;
    z-index: 999999;
    margin-top: 5px;
  }

  /* 搜索结果分页样式 */
  .search-pagination {
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 15px;
    border-top: 1px solid #eee;
  }

  .search-pagination button {
    margin: 0 5px;
    padding: 5px 10px;
    background: #f8f9fa;
    border: 1px solid #dadce0;
    border-radius: 4px;
    color: #520049;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .search-pagination button:hover {
    background: #e8f0fe;
    border-color: #520049;
  }

  .search-pagination button.active {
    background: #520049;
    color: white;
    border-color: #520049;
  }

  .search-pagination button:disabled {
    color: #70757a;
    background: #f8f9fa;
    cursor: not-allowed;
    opacity: 0.5;
  }

  .search-pagination .page-info {
    margin: 0 10px;
    color: #70757a;
    font-size: 14px;
  }

  /* 图片缩略图样式 */
  .search-result-thumbnail {
    width: 80px;
    height: 80px;
    object-fit: cover;
    border-radius: 4px;
    margin-right: 15px;
  }

  .search-result-with-thumbnail {
    display: flex !important;
    flex-direction: row !important;
  }

  .search-result-content {
    flex: 1;
  }

  /* 关键词高亮样式 */
  .keyword-highlight {
    background-color: #ffeaa7;
    font-weight: bold;
    padding: 0 2px;
  }
</style>





<div class="navbar navbar-expand-lg navbar-dark bg-primary" style='border-radius: 0; border: 0;' role="navigation">

  <div class="container-fluidmiao" style='max-width: 75%;'>
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse-1"
        aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="{{ site.url }}{{ site.baseurl }}/">

        <img class="navbar-brand" src="{{ site.url }}{{ site.baseurl }}/images/aptamer-logo.svg"
          style='height:50px;margin-top:-14px;margin-bottom:0;padding:2px 2px;border-radius: 0;' alt="logo">
        <!--b style='font-size: 32px; color: #eeeeee;'>Ribocentre-aptamer</b-->
      </a>
    </div>
    <div class="collapse navbar-collapse" id="navbar-collapse-1">
      <ul class="nav navbar-nav navbar-right">
        <li><a class="nav-link-1" href="{{ site.url }}{{ site.baseurl }}/" style="font-size: 20px">Home</a></li>
        <li><a class="nav-link-1" href="{{ site.url }}{{ site.baseurl }}/Ribocentre-aptamer/"
            style="font-size: 20px">Aptamers</a></li>
        <li><a class="nav-link-1" href="{{ site.url }}{{ site.baseurl }}/SELEX/" style="font-size: 20px">SELEX</a></li>
        <li><a class="nav-link-1" href="{{ site.url }}{{ site.baseurl }}/fluorescences/"
            style="font-size: 20px">Fluorescences</a></li>
        <li><a class="nav-link-1" href="{{ site.url }}{{ site.baseurl }}/sequences/"
            style="font-size: 20px;">Sequences</a></li>
        <li><a class="nav-link-1" href="{{ site.url }}{{ site.baseurl }}/structures/"
            style="font-size: 20px;">Structures</a></li>
        <li><a class="nav-link-1" href="{{ site.url }}{{ site.baseurl }}/applications/"
            style="font-size: 20px">Applications</a></li>
        <li><a class="nav-link-1" href="{{ site.url }}{{ site.baseurl }}/publications/"
            style="font-size: 20px">Publications</a></li>
        <li><a class="nav-link-1" href="{{ site.url }}{{ site.baseurl }}/helps/" style="font-size: 20px">Help</a></li>
      </ul>
    </div>
  </div>
</div>


<!-- 页面底部添加JavaScript实现搜索功能 -->
<script>
  // 简单搜索实现，不依赖外部库
  document.addEventListener('DOMContentLoaded', function () {
    var searchInput = document.getElementById('search-box-header');
    var resultsContainer = document.getElementById('search-results-header');
    var searchButton = document.getElementById('search-button-header');

    if (!searchInput || !resultsContainer || !searchButton) {
      console.error('搜索元素未找到');
      return;
    }

    // 页面状态变量
    var currentPage = 1;
    var resultsPerPage = 10;
    var allSearchResults = [];

    // 点击页面其他区域关闭搜索结果
    document.addEventListener('click', function (event) {
      if (!searchInput.contains(event.target) && !resultsContainer.contains(event.target) && !searchButton.contains(event.target)) {
        resultsContainer.style.display = 'none';
      }
    });

    // 计算文本相关性分数 - 增强版
    function calculateRelevanceScore(item, query) {
      var score = 0;
      // 将查询拆分为单独的关键词
      var queryTerms = query.toLowerCase().split(/\s+/).filter(function (term) {
        return term.length > 0;
      });
      var fullQuery = query.toLowerCase();

      // 检查字段是否存在
      var titleLower = item.title ? item.title.toLowerCase() : '';
      var categoryLower = item.category ? item.category.toLowerCase() : '';
      var tagsLower = item.tags ? item.tags.toLowerCase() : '';
      var contentLower = item.content ? item.content.toLowerCase() : '';

      // 精确匹配完整查询词 - 最高权重
      if (titleLower.indexOf(fullQuery) !== -1) score += 200; // 标题中有完整查询词
      if (contentLower.indexOf(fullQuery) !== -1) score += 100; // 内容中有完整查询词
      if (categoryLower.indexOf(fullQuery) !== -1) score += 80; // 分类中有完整查询词
      if (tagsLower.indexOf(fullQuery) !== -1) score += 90; // 标签中有完整查询词

      // 检查每个关键词的匹配情况
      var matchedTerms = 0;
      queryTerms.forEach(function (term) {
        let termMatched = false;

        // 标题匹配权重最高
        if (titleLower === term) {
          score += 100; // 标题与单词完全匹配
          termMatched = true;
        } else if (titleLower.indexOf(term) === 0) {
          score += 80; // 标题以关键词开头
          termMatched = true;
        } else if (titleLower.indexOf(term) !== -1) {
          score += 60; // 标题包含关键词
          termMatched = true;
        }

        // 分类匹配
        if (categoryLower.indexOf(term) !== -1) {
          score += 30;
          termMatched = true;
        }

        // 标签匹配
        if (tagsLower.indexOf(term) !== -1) {
          score += 40;
          termMatched = true;
        }

        // 内容匹配
        if (contentLower.indexOf(term) !== -1) {
          // 计算关键词在内容中出现的次数
          var escapedTerm = escapeRegExp(term);
          var regex = new RegExp(escapedTerm, 'gi');
          var count = (contentLower.match(regex) || []).length;

          // 根据出现次数和单词长度加权
          var termWeight = Math.min(count * (term.length > 3 ? 3 : 2), 30); // 避免单个词出现太多次权重过高
          score += termWeight;
          termMatched = true;
        }

        if (termMatched) matchedTerms++;
      });

      // 匹配词数占比加成 - 如果查询有多个词，且都匹配到了，给额外加分
      if (queryTerms.length > 1 && matchedTerms > 0) {
        var matchRatio = matchedTerms / queryTerms.length;
        score += matchRatio * 50; // 完全匹配所有词可获得50分加成
      }

      return score;
    }

    // 高亮关键词 - 修改版本，避免高亮HTML标签内文本
    function highlightKeywords(text, query) {
      if (!text) return '';

      // 先查找所有HTML标签，将它们替换为占位符
      var tags = [];
      var tagPattern = /<[^>]*>/g;
      var tagMatch;
      var tempText = text;

      while ((tagMatch = tagPattern.exec(text)) !== null) {
        var tag = tagMatch[0];
        var placeholder = `__TAG_${tags.length}__`;
        tags.push(tag);
        tempText = tempText.replace(tag, placeholder);
      }

      // 在临时文本上执行关键词高亮
      var queryTerms = query.toLowerCase().split(/\s+/).filter(function (term) {
        return term.length > 1; // 忽略单字符词
      });

      // 首先尝试高亮完整查询
      var escapedFullQuery = escapeRegExp(query);
      var fullQueryRegex = new RegExp('(' + escapedFullQuery + ')', 'gi');
      tempText = tempText.replace(fullQueryRegex, '<span class="keyword-highlight">$1</span>');

      // 然后尝试高亮单个词
      queryTerms.forEach(function (term) {
        if (term.length < 2) return; // 忽略单字符词
        var escapedTerm = escapeRegExp(term);
        var regex = new RegExp('(' + escapedTerm + ')', 'gi');
        tempText = tempText.replace(regex, '<span class="keyword-highlight">$1</span>');
      });

      // 恢复HTML标签
      for (var i = 0; i < tags.length; i++) {
        tempText = tempText.replace(`__TAG_${i}__`, tags[i]);
      }

      return tempText;
    }

    // 提取包含关键词的上下文
    function extractContext(text, query) {
      if (!text) return '';

      var contextLength = 250; // 增加上下文长度
      var textLower = text.toLowerCase();
      var queryLower = query.toLowerCase();
      var queryTerms = queryLower.split(/\s+/).filter(function (term) {
        return term.length > 1;
      });

      // 尝试找出最佳上下文段落 - 优先匹配完整查询，其次匹配最多关键词的段落
      var bestStart = -1;
      var bestMatchCount = 0;
      var bestTermIndex = -1;
      var chunkSize = 200; // 增加滑动窗口大小

      // 先检查是否有完整查询匹配
      var fullQueryIndex = textLower.indexOf(queryLower);
      if (fullQueryIndex !== -1) {
        bestStart = fullQueryIndex;
      } else {
        // 没有完整匹配，先检查单个关键词的精确位置
        for (var i = 0; i < queryTerms.length; i++) {
          var term = queryTerms[i];
          if (term.length < 2) continue;

          var termIndex = textLower.indexOf(term);
          if (termIndex !== -1) {
            // 找到了一个关键词
            if (bestStart === -1 || bestMatchCount === 0) {
              bestStart = termIndex;
              bestTermIndex = termIndex;
              bestMatchCount = 1;
            }
          }
        }

        // 如果找到了单个关键词，检查附近是否有更多的关键词
        if (bestStart !== -1) {
          // 尝试找到包含最多关键词的文本段落
          for (var i = Math.max(0, bestStart - 100); i < Math.min(textLower.length, bestStart + 300); i += chunkSize / 4) {
            var chunkEnd = Math.min(i + chunkSize, textLower.length);
            var chunk = textLower.substring(i, chunkEnd);
            var matchCount = 0;

            // 计算当前段落包含多少个关键词
            queryTerms.forEach(function (term) {
              if (chunk.indexOf(term) !== -1) {
                matchCount++;
              }
            });

            // 如果找到包含更多关键词的段落，更新最佳起始位置
            if (matchCount > bestMatchCount) {
              bestMatchCount = matchCount;
              bestStart = i;
            }
          }
        } else {
          // 没有找到单个关键词，尝试使用分块方法找到最相关的段落
          for (var i = 0; i < textLower.length; i += chunkSize / 4) {
            var chunkEnd = Math.min(i + chunkSize, textLower.length);
            var chunk = textLower.substring(i, chunkEnd);
            var matchCount = 0;

            // 计算当前段落包含多少个关键词
            queryTerms.forEach(function (term) {
              if (chunk.indexOf(term) !== -1) {
                matchCount++;
              }
            });

            // 如果找到包含更多关键词的段落，更新最佳起始位置
            if (matchCount > bestMatchCount) {
              bestMatchCount = matchCount;
              bestStart = i;
            }
          }
        }
      }

      // 如果没有找到任何匹配，但我们有内容，则返回文本开头
      if (bestStart === -1) {
        return text.substring(0, Math.min(contextLength, text.length));
      }

      // 提取上下文，确保不超出文本边界
      var start = Math.max(0, bestStart - contextLength / 3);
      var end = Math.min(text.length, bestStart + contextLength * 2 / 3);

      // 调整到单词边界
      if (start > 0) {
        while (start > 0 && !/\s/.test(text[start])) start--;
        if (start > 0) start++; // 避免以空格开头
      }

      if (end < text.length) {
        while (end < text.length && !/\s/.test(text[end])) end++;
      }

      var context = text.substring(start, end);

      // 添加省略号
      if (start > 0) context = '...' + context;
      if (end < text.length) context = context + '...';

      // 确认提取的上下文中包含至少一个关键词
      var contextLower = context.toLowerCase();
      var containsKeyword = queryLower.length > 0 && contextLower.indexOf(queryLower) !== -1;

      if (!containsKeyword) {
        for (var i = 0; i < queryTerms.length; i++) {
          if (queryTerms[i].length > 1 && contextLower.indexOf(queryTerms[i]) !== -1) {
            containsKeyword = true;
            break;
          }
        }
      }

      // 如果提取的上下文不包含关键词，尝试找到一个包含关键词的段落
      if (!containsKeyword && bestTermIndex !== -1) {
        start = Math.max(0, bestTermIndex - contextLength / 3);
        end = Math.min(text.length, bestTermIndex + contextLength * 2 / 3);

        if (start > 0) {
          while (start > 0 && !/\s/.test(text[start])) start--;
          if (start > 0) start++; // 避免以空格开头
        }

        if (end < text.length) {
          while (end < text.length && !/\s/.test(text[end])) end++;
        }

        context = text.substring(start, end);

        // 添加省略号
        if (start > 0) context = '...' + context;
        if (end < text.length) context = context + '...';
      }

      return context;
    }

    // 转义正则表达式中的特殊字符
    function escapeRegExp(string) {
      return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'); // $&表示匹配到的字符串
    }

    // 查找页面第一张图片
    function findFirstImage(content) {
      if (!content) return null;

      // 尝试从HTML内容中提取第一个img标签
      var imgRegex = /<img.*?src=["'](.*?)["']/i;
      var match = content.match(imgRegex);
      if (match && match[1]) {
        return match[1];
      }

      // 如果是markdown内容，尝试提取markdown图片语法
      var mdRegex = /!\[.*?\]\((.*?)\)/i;
      match = content.match(mdRegex);
      if (match && match[1]) {
        return match[1];
      }

      return null;
    }

    // 渲染分页控件
    function renderPagination() {
      var totalPages = Math.ceil(allSearchResults.length / resultsPerPage);

      if (totalPages <= 1) {
        return ''; // 不需要分页
      }

      var html = '<div class="search-pagination">';

      // 添加First按钮
      html += '<button ' + (currentPage === 1 ? 'disabled' : '') + ' id="first-page">First</button>';

      // 上一页按钮
      html += '<button ' + (currentPage === 1 ? 'disabled' : '') + ' id="prev-page">Previous</button>';

      // 页码按钮
      var startPage = Math.max(1, currentPage - 2);
      var endPage = Math.min(totalPages, startPage + 4);

      if (endPage - startPage < 4 && startPage > 1) {
        startPage = Math.max(1, endPage - 4);
      }

      for (var i = startPage; i <= endPage; i++) {
        html += '<button class="' + (i === currentPage ? 'active' : '') + '" data-page="' + i + '">' + i + '</button>';
      }

      // 下一页按钮
      html += '<button ' + (currentPage === totalPages ? 'disabled' : '') + ' id="next-page">Next</button>';

      // 添加Last按钮
      html += '<button ' + (currentPage === totalPages ? 'disabled' : '') + ' id="last-page">Last</button>';

      // 页码信息
      html += '<span class="page-info">Page ' + currentPage + ' of ' + totalPages + '</span>';

      html += '</div>';
      return html;
    }

    // 搜索函数
    function performSearch() {
      var query = searchInput.value.trim();
      if (!query) {
        resultsContainer.style.display = 'none';
        return;
      }

      // 显示加载状态
      resultsContainer.innerHTML = '<div class="loading-message">正在搜索</div>';
      resultsContainer.style.display = 'block';

      // 尝试多种可能的路径
      var searchJsonPaths = [
        '{{ site.url }}{{ site.baseurl }}/search.json',
        '/search.json',
        './search.json',
        window.location.origin + '/search.json',
        'search.json'
      ];

      // 重置页码
      currentPage = 1;

      // 逐个尝试路径
      tryNextPath(0);

      function tryNextPath(index) {
        if (index >= searchJsonPaths.length) {
          resultsContainer.innerHTML = '<div class="no-results-message">无法加载搜索数据，请稍后再试。</div>';
          return;
        }

        console.log('尝试加载搜索索引:', searchJsonPaths[index]);

        fetch(searchJsonPaths[index])
          .then(function (response) {
            if (!response.ok) {
              throw new Error('搜索数据加载失败');
            }
            return response.text(); // 先获取文本响应
          })
          .then(function (text) {
            try {
              // 尝试解析JSON
              var data = JSON.parse(text);
              processSearchResults(data);
            } catch (e) {
              console.error('JSON解析错误:', e);
              // 可能是由于Jekyll在开发环境中的模板标记没有被处理
              // 尝试移除可能的前面部分
              var jsonStart = text.indexOf('[');
              if (jsonStart !== -1) {
                try {
                  var cleanedText = text.substring(jsonStart);
                  var data = JSON.parse(cleanedText);
                  processSearchResults(data);
                  return;
                } catch (e) {
                  console.error('清理后的JSON仍然无效:', e);
                }
              }

              // 尝试下一个路径
              tryNextPath(index + 1);
            }
          })
          .catch(function (error) {
            console.error('搜索路径错误:', searchJsonPaths[index], error);
            // 尝试下一个路径
            tryNextPath(index + 1);
          });
      }

      function processSearchResults(data) {
        var results = [];
        var startTime = new Date().getTime();
        var queryLower = query.toLowerCase();
        var queryTerms = queryLower.split(/\s+/).filter(function (term) {
          return term.length > 0;
        });

        // 查找匹配项
        data.forEach(function (item) {
          // 获取所有要搜索的字段，转为小写
          var titleLower = item.title ? item.title.toLowerCase() : '';
          var categoryLower = item.category ? item.category.toLowerCase() : '';
          var tagsLower = item.tags ? item.tags.toLowerCase() : '';
          var contentLower = item.content ? item.content.toLowerCase() : '';

          var matched = false;

          // 检查完整查询词匹配
          if (
            titleLower.indexOf(queryLower) !== -1 ||
            categoryLower.indexOf(queryLower) !== -1 ||
            tagsLower.indexOf(queryLower) !== -1 ||
            contentLower.indexOf(queryLower) !== -1
          ) {
            matched = true;
          } else {
            // 检查分词匹配 - 任何一个词匹配即可
            for (var i = 0; i < queryTerms.length; i++) {
              var term = queryTerms[i];
              if (
                titleLower.indexOf(term) !== -1 ||
                categoryLower.indexOf(term) !== -1 ||
                tagsLower.indexOf(term) !== -1 ||
                contentLower.indexOf(term) !== -1
              ) {
                matched = true;
                break;
              }
            }
          }

          if (matched) {
            // 添加相关性分数
            item.relevanceScore = calculateRelevanceScore(item, query);
            results.push(item);
          }
        });

        // 按相关性分数排序
        results.sort(function (a, b) {
          return b.relevanceScore - a.relevanceScore;
        });

        // 保存所有结果，用于分页
        allSearchResults = results;

        // 计算搜索用时
        var searchTime = (new Date().getTime() - startTime) / 1000;

        // 显示当前页的结果
        renderResults(searchTime);
      }

      function renderResults(searchTime) {
        if (allSearchResults.length > 0) {
          var startIndex = (currentPage - 1) * resultsPerPage;
          var endIndex = Math.min(startIndex + resultsPerPage, allSearchResults.length);
          var currentResults = allSearchResults.slice(startIndex, endIndex);

          var html = '<div class="result-count">About ' + allSearchResults.length + ' results (' + searchTime.toFixed(2) + ' seconds)</div>';

          currentResults.forEach(function (item, index) {
            // 提取上下文并高亮关键词
            var contentPreview = '';
            if (item.content) {
              // 首先尝试直接在内容中搜索关键词
              var fullContentLower = item.content.toLowerCase();
              var queryLower = query.toLowerCase();
              var queryTerms = queryLower.split(/\s+/).filter(term => term.length > 1);

              // 尝试找到第一个匹配的关键词位置
              var keywordPos = -1;
              var matchedKeyword = '';

              // 首先尝试完整查询
              keywordPos = fullContentLower.indexOf(queryLower);
              if (keywordPos !== -1) {
                matchedKeyword = queryLower;
              }

              // 如果完整查询没找到，尝试查找单个关键词
              if (keywordPos === -1) {
                for (var i = 0; i < queryTerms.length; i++) {
                  if (queryTerms[i].length > 1) {
                    var termPos = fullContentLower.indexOf(queryTerms[i]);
                    if (termPos !== -1) {
                      keywordPos = termPos;
                      matchedKeyword = queryTerms[i];
                      break;
                    }
                  }
                }
              }

              // 如果找到关键词位置
              if (keywordPos !== -1) {
                // 获取关键词周围的上下文
                var contextLength = 300; // 增加上下文长度以确保显示足够内容
                var start = Math.max(0, keywordPos - contextLength / 3);
                var end = Math.min(item.content.length, keywordPos + contextLength * 2 / 3);

                // 调整到单词边界
                if (start > 0) {
                  while (start > 0 && !/\s/.test(item.content[start])) start--;
                  if (start > 0) start++;
                }

                if (end < item.content.length) {
                  while (end < item.content.length && !/\s/.test(item.content[end])) end++;
                }

                contentPreview = item.content.substring(start, end);

                // 添加省略号
                if (start > 0) contentPreview = '...' + contentPreview;
                if (end < item.content.length) contentPreview = contentPreview + '...';

                // 确认生成的预览包含关键词
                var previewLower = contentPreview.toLowerCase();
                if (previewLower.indexOf(matchedKeyword) === -1) {
                  // 如果somehow预览不包含关键词，直接使用关键词所在位置
                  start = Math.max(0, keywordPos - 50);
                  end = Math.min(item.content.length, keywordPos + matchedKeyword.length + 150);
                  contentPreview = '...' + item.content.substring(start, end) + '...';
                }
              } else {
                // 这个条件不应该发生，因为之前的匹配确保了内容中包含关键词
                // 但是为了健壮性，我们仍然提供一个备选方案
                contentPreview = item.content.substring(0, 200) + '...';
                console.warn('搜索结果索引 ' + (startIndex + index) + ' 未找到关键词位置，但之前匹配成功');
              }

              // 高亮所有关键词
              contentPreview = highlightKeywords(contentPreview, query);
            }

            // 查找第一张图片
            var firstImage = findFirstImage(item.content);

            // 生成结果项HTML - 为整个项目添加data-url属性用于跳转
            var resultItemClass = firstImage ? 'search-result-item search-result-with-thumbnail' : 'search-result-item';
            html += '<div class="' + resultItemClass + '" data-url="' + item.url + '" data-index="' + (startIndex + index) + '">';

            // 如果有图片，添加缩略图
            if (firstImage) {
              html += '<img src="' + firstImage + '" alt="Thumbnail" class="search-result-thumbnail">';
            }

            // 结果内容
            html += '<div class="search-result-content">';
            // 标题不再包含链接，只显示文本
            html += '<h4>' + highlightKeywords(item.title, query) + '</h4>';

            if (item.category) {
              html += '<div class="category">' + highlightKeywords(item.category, query) + '</div>';
            }

            html += '<div class="content-preview">' + contentPreview + '</div>';

            html += '<div class="search-result-meta">';
            if (item.tags) {
              html += '<div class="tags">' + highlightKeywords(item.tags, query) + '</div>';
            }
            if (item.date) {
              html += '<div class="search-result-date">' + item.date + '</div>';
            }
            html += '</div>'; // close .search-result-meta

            html += '</div>'; // close .search-result-content
            html += '</div>'; // close .search-result-item
          });

          // 添加分页控件
          html += renderPagination();

          // 更新HTML内容
          resultsContainer.innerHTML = html;

          // 为每个结果项添加点击事件
          var resultItems = resultsContainer.querySelectorAll('.search-result-item');
          resultItems.forEach(function (item) {
            item.addEventListener('click', function (e) {
              // 防止冒泡和默认行为
              if (e.target.tagName === 'BUTTON') return; // 忽略分页按钮的点击

              var url = this.getAttribute('data-url');
              if (url) {
                // window.location.href = url;
                window.open(url, '_blank'); // 在新标签页打开链接
              }
            });
          });

          // 添加分页事件监听器
          var firstButton = document.getElementById('first-page');
          var prevButton = document.getElementById('prev-page');
          var nextButton = document.getElementById('next-page');
          var lastButton = document.getElementById('last-page');
          var pageButtons = document.querySelectorAll('.search-pagination button[data-page]');

          if (firstButton) {
            firstButton.addEventListener('click', function (e) {
              e.preventDefault();
              e.stopPropagation();
              if (currentPage > 1) {
                currentPage = 1;
                renderResults(searchTime);
                // 保持搜索结果可见
                resultsContainer.style.display = 'block';
              }
            });
          }

          if (prevButton) {
            prevButton.addEventListener('click', function (e) {
              e.preventDefault();
              e.stopPropagation();
              if (currentPage > 1) {
                currentPage--;
                renderResults(searchTime);
                // 保持搜索结果可见
                resultsContainer.style.display = 'block';
              }
            });
          }

          if (nextButton) {
            nextButton.addEventListener('click', function (e) {
              e.preventDefault();
              e.stopPropagation();
              var totalPages = Math.ceil(allSearchResults.length / resultsPerPage);
              if (currentPage < totalPages) {
                currentPage++;
                renderResults(searchTime);
                // 保持搜索结果可见
                resultsContainer.style.display = 'block';
              }
            });
          }

          if (lastButton) {
            lastButton.addEventListener('click', function (e) {
              e.preventDefault();
              e.stopPropagation();
              var totalPages = Math.ceil(allSearchResults.length / resultsPerPage);
              if (currentPage < totalPages) {
                currentPage = totalPages;
                renderResults(searchTime);
                // 保持搜索结果可见
                resultsContainer.style.display = 'block';
              }
            });
          }

          pageButtons.forEach(function (button) {
            button.addEventListener('click', function (e) {
              e.preventDefault();
              e.stopPropagation();
              currentPage = parseInt(this.getAttribute('data-page'));
              renderResults(searchTime);
              // 保持搜索结果可见
              resultsContainer.style.display = 'block';
            });
          });

          // 调整搜索结果容器样式
          resultsContainer.style.display = 'block';

          // 检查是否在首页
          var isHomepage = document.querySelector('.full-width-image .search-box .search');
          if (isHomepage) {
            var wrapper = resultsContainer.closest('.search-results-wrapper');
            if (wrapper) {
              wrapper.style.position = 'absolute';
              wrapper.style.width = '100%';
              wrapper.style.maxWidth = '600px';
              wrapper.style.top = '100%';
              wrapper.style.left = '0';
              wrapper.style.zIndex = '999999';
            }
            resultsContainer.style.position = 'relative';
            resultsContainer.style.width = '100%';
            resultsContainer.style.maxWidth = '600px';
            resultsContainer.style.backgroundColor = 'white';
            resultsContainer.style.boxShadow = '0 5px 20px rgba(0,0,0,0.25)';
            resultsContainer.style.borderRadius = '8px';
            resultsContainer.style.marginTop = '5px';
            resultsContainer.style.zIndex = '999999';
          }
        } else {
          resultsContainer.innerHTML = '<div class="no-results-message">No results found. Please try different keywords.</div>';
          resultsContainer.style.display = 'block';
        }
      }
    }

    // 输入框事件监听
    searchInput.addEventListener('input', function () {
      if (searchInput.value.trim() !== '') {
        performSearch();
      } else {
        resultsContainer.style.display = 'none';
      }
    });

    // 获得焦点时
    searchInput.addEventListener('focus', function () {
      if (searchInput.value.trim() !== '') {
        performSearch();
      }
    });

    // 搜索按钮点击
    searchButton.addEventListener('click', function () {
      if (searchInput.value.trim() !== '') {
        performSearch();
      }
    });

    // 回车键搜索
    searchInput.addEventListener('keyup', function (event) {
      if (event.key === 'Enter' && searchInput.value.trim() !== '') {
        performSearch();
      }
    });
  });
</script>

<!-- 尝试加载外部搜索脚本 -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    // 获取当前页面的路径和域名
    var currentPath = window.location.pathname;
    var currentOrigin = window.location.origin;
    var siteUrl = '{{ site.url }}';
    var siteBaseurl = '{{ site.baseurl }}';

    // 检查search.json文件是否可访问
    var jsonPath = currentOrigin + siteBaseurl + '/search.json';
    console.log('尝试加载搜索索引:', jsonPath);

    // 尝试多种可能的路径
    var searchJsonPaths = [
      jsonPath,
      '/search.json',
      './search.json',
      currentOrigin + '/search.json',
      'search.json'
    ];

    // 逐个尝试路径
    tryNextPath(0);

    function tryNextPath(index) {
      if (index >= searchJsonPaths.length) {
        console.error('所有搜索索引路径都无法访问');
        return;
      }

      console.log('尝试加载搜索索引:', searchJsonPaths[index]);

      fetch(searchJsonPaths[index])
        .then(response => {
          if (!response.ok) {
            console.error('无法加载search.json文件，状态码:', response.status);
            // 尝试下一个路径
            tryNextPath(index + 1);
            return null;
          }
          console.log('search.json文件加载成功');
          return response.text();
        })
        .then(text => {
          if (!text) return;

          try {
            // 尝试解析JSON
            var data = JSON.parse(text);
            console.log('search.json内容可用:', !!data);
            // 初始化搜索
            initSearch(searchJsonPaths[index]);
          } catch (e) {
            console.error('JSON解析错误:', e);
            // 可能是由于Jekyll在开发环境中的模板标记没有被处理
            // 尝试移除可能的前面部分
            var jsonStart = text.indexOf('[');
            if (jsonStart !== -1) {
              try {
                var cleanedText = text.substring(jsonStart);
                var data = JSON.parse(cleanedText);
                console.log('搜索JSON清理后可用');
                initSearch(searchJsonPaths[index]);
                return;
              } catch (e) {
                console.error('清理后的JSON仍然无效:', e);
              }
            }

            // 尝试下一个路径
            tryNextPath(index + 1);
          }
        })
        .catch(error => {
          console.error('加载search.json时出错:', error);
          console.log('尝试使用下一个路径');
          // 尝试下一个路径
          tryNextPath(index + 1);
        });
    }

    function initSearch(jsonPath) {
      // 不再需要加载SimpleJekyllSearch插件，因为我们已经实现了自定义搜索
      console.log('使用增强搜索功能');
    }
  });
</script>
