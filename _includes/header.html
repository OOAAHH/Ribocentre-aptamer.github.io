<!-- 外部导航栏 (GZNL) -->
<div class="navbar-expand-lg navbar-dark"
  style='background-color: #333333; border-radius: 0; margin-bottom: 0; border: 0; height: 30px; position: relative; z-index: 1100;' role="navigation">
  <div class="container-fluidmiao" style='height: 30px; max-width: 1000px; position: relative;'>
    <!-- 移动端折叠按钮 -->
    <button class="navbar-toggler external-toggler" type="button" style="position: absolute; right: 10px; top: 3px; padding: 2px 5px; display: none;">
      <span style="color: white; font-size: 18px;">☰</span>
    </button>
    
    <ul class="nav navbar-nav navbar-right external-nav" style='height: 30px;'>
      <li><a style='display: inline; padding: 15px 15px 5px 5px; line-height: 30px;' class="nav-link-0"
          href="https://www.gznl.org/">
          <img src="{{ site.url }}{{ site.baseurl }}/images/header/home.svg"
            style='height: 20px; width: auto; margin: 0;'>
          Home</a></li>
      <li><a style='display: inline; padding: 15px 15px 5px 5px; line-height: 30px;' class="nav-link-0"
          href="https://www.gznl.org/database/">
          <img src="{{ site.url }}{{ site.baseurl }}/images/header/database.svg"
            style='height: 20px; width: auto; margin: 0;'>
          Database</a></li>
      <li><a style='display: inline; padding: 15px 15px 5px 5px; line-height: 30px;' class="nav-link-0"
          href="https://www.gznl.org/research/">
          <img src="{{ site.url }}{{ site.baseurl }}/images/header/research.svg"
            style='height: 20px; width: auto; margin: 0;'>
          Research</a></li>
      <li><a style='display: inline; padding: 15px 15px 5px 5px; line-height: 30px;' class="nav-link-0"
          href="https://www.gznl.org/aboutus/">
          <img src="{{ site.url }}{{ site.baseurl }}/images/header/aboutus.svg"
            style='height: 20px; width: auto; margin: 0;'>
          About us</a></li>
      <li><a style='display: inline; padding: 15px 15px 5px 5px; line-height: 30px;' class="nav-link-0"
          href="javascript:void(0);" onclick="document.getElementById('search-box-header').focus(); var externalNav = document.querySelector('.external-nav'); if(externalNav && externalNav.classList.contains('show')) { externalNav.classList.remove('show'); }">
          <img src="{{ site.url }}{{ site.baseurl }}/images/header/search.svg"
            style='height: 20px; width: auto; margin: 0;'>
          Search</a></li>
      <li><a style='display: inline; padding: 15px 15px 5px 5px; line-height: 30px;' class="nav-link-0"
          href="https://gzlab.ac.cn/">
          GZNL-RDC
          <img src="{{ site.url }}{{ site.baseurl }}/images/header/gznl2.svg"
            style='height: 20px; width: auto; margin: 0;'>
        </a></li>
    </ul>
  </div>
</div>

<!-- 首页搜索区域 -->
{% unless page.url == '/advanced-search/' or page.permalink == '/advanced-search/' %}
<div class="full-width-image">
  <div class="search-box">
    <div class="search">
      <h1>GZNL's Respiratory Data Centre, GZNL-RDC</h1>
      <div class="i"><img src="/images/logo.svg">
        <h1><b>Ribocentre-aptamer</b></h1>
      </div>
      <p>A database of RNA aptamers</p>

      <!-- Google 风格搜索框 -->
      <div class="google-search-container">
        <div class="search-input-container">
          <div class="search-icon" id="search-button-header">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="#9aa0a6" class="bi bi-search"
              viewBox="0 0 16 16">
              <path
                d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z" />
            </svg>
          </div>
          <input type="text" id="search-box-header" class="google-search-input" placeholder="Search RNA aptamers..."
            aria-label="Search keywords" autocomplete="off">
        </div>
        <div class="search-results-wrapper">
          <div id="search-results-header" class="search-results-container" style="display: none;"></div>
        </div>
      </div>

      <p>Example:
        <a class="tip" href="{{ site.url }}{{ site.baseurl }}/Ribocentre-aptamer/">RNA aptamer</a>&nbsp;&nbsp;
        <a class="tip" href="{{ site.url }}{{ site.baseurl }}/SELEX/">SELEX</a>&nbsp;&nbsp;
        <a class="tip" href="{{ site.url }}{{ site.baseurl }}/_posts/ATP-aptamer" target="_blank">ATP aptamer</a>&nbsp;&nbsp;
        <a class="tip" href="{{ site.url }}{{ site.baseurl }}/structures/">Structure</a>&nbsp;&nbsp;
      </p>
    </div>
  </div>
</div>
{% endunless %}

<!-- 内部导航栏 (Aptamer) -->
<div class="navbar navbar-expand-lg navbar-dark bg-primary" style='border-radius: 0; border: 0;' role="navigation">
  <div class="container-fluidmiao" style='max-width: 75%; position: relative;'>
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed internal-toggler" data-toggle="collapse" data-target="#navbar-collapse-1"
        aria-expanded="false" style="position: absolute; right: 10px; top: 10px;">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="{{ site.url }}{{ site.baseurl }}/">
        <img class="navbar-brand" src="{{ site.url }}{{ site.baseurl }}/images/aptamer-logo.svg"
          style='height: auto; max-height: 50px; width: auto; margin: 0; padding: 5px;' alt="logo">
      </a>
    </div>
    <div class="collapse navbar-collapse" id="navbar-collapse-1">
      <ul class="nav navbar-nav navbar-right">
        <li><a class="nav-link-1" href="{{ site.url }}{{ site.baseurl }}/">Home</a></li>
        
        <!-- Aptamers 下拉菜单 -->
        <li class="dropdown">
          <a href="#" class="nav-link-1 dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
            Aptamers <span class="caret"></span>
          </a>
          <ul class="dropdown-menu">
            <li><a href="{{ site.url }}{{ site.baseurl }}/Ribocentre-aptamer/">Aptamers</a></li>
            <li><a href="{{ site.url }}{{ site.baseurl }}/SELEX/">SELEX</a></li>
            <li><a href="{{ site.url }}{{ site.baseurl }}/fluorescence/">Fluorescence</a></li>
          </ul>
        </li>
        
        <li><a class="nav-link-1" href="{{ site.url }}{{ site.baseurl }}/applications/">Applications</a></li>
        <li><a class="nav-link-1" href="{{ site.url }}{{ site.baseurl }}/publications/">Publications</a></li>
        
        <!-- Download 下拉菜单 -->
        <li class="dropdown">
          <a href="#" class="nav-link-1 dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
            Download <span class="caret"></span>
          </a>
          <ul class="dropdown-menu">
            <li><a href="{{ site.url }}{{ site.baseurl }}/sequences/">Sequences</a></li>
            <li><a href="{{ site.url }}{{ site.baseurl }}/structures/">Structures</a></li>
          </ul>
        </li>
        
        <li><a class="nav-link-1" href="{{ site.url }}{{ site.baseurl }}/advanced-search/">Search</a></li>
        <li><a class="nav-link-1" href="{{ site.url }}{{ site.baseurl }}/helps/">Help</a></li>
      </ul>
    </div>
  </div>
</div>

<style>
  /* 首页搜索区域样式 */
  .full-width-image {
    width: 100%;
    height: 350px;
    overflow: hidden;
    border-radius: 0;
    margin-top: 0;
    margin-bottom: 0;
    position: relative;
    background: url(../../images/homepicture2.jpeg) no-repeat;
    background-size: cover;
    background-position: center;
  }

  .search-box {
    height: 100%;
    width: 72%;
    margin: 0 auto;
    display: flex;
    align-items: center;
  }

  .search {
    padding: 0 20px;
    background: #fff;
    position: absolute;
    width: 100%;
    max-width: 600px;
  }

  .search h1 {
    font-size: 20px;
  }

  .search .i {
    display: flex;
    align-items: center;
  }

  .search .i img {
    width: 70px;
    object-fit: contain;
  }

  .search .i h1 {
    font-size: 28px;
    font-weight: 700;
    margin-left: 10px;
  }

  .search .tip {
    font-size: 14px;
    margin-top: 10px;
  }

  /* Google风格搜索框 */
  .google-search-container {
    position: relative;
    width: 100%;
    margin-bottom: 20px;
    z-index: 1015; /* 适当的z-index */
  }

  .search-input-container {
    display: flex;
    width: 100%;
    position: relative;
    align-items: center;
    background-color: white;
    border: 1px solid #dfe1e5;
    border-radius: 24px;
    box-shadow: 0 1px 6px rgba(32, 33, 36, 0.28);
    height: 44px;
  }

  .search-input-container:hover,
  .search-input-container:focus-within {
    box-shadow: 0 1px 6px rgba(32, 33, 36, 0.38);
    border-color: rgba(223, 225, 229, 0);
  }

  .search-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0 14px;
    cursor: pointer;
  }

  .google-search-input {
    flex: 1;
    height: 100%;
    border: none;
    outline: none;
    font-size: 16px;
    background: transparent;
    width: 100%;
    padding: 0 16px 0 0;
    margin-bottom: 0;
  }

  /* 搜索结果样式 */
  .search-results-wrapper {
    position: absolute;
    top: 100%;
    left: 0;
    width: 100%;
    z-index: 1020; /* 确保高于导航菜单 */
    margin-top: 5px;
  }

  .search-results-container {
    position: relative;
    width: 100%;
    background-color: white;
    border-radius: 8px;
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.25);
    z-index: 1020; /* 确保高于导航菜单 */
    margin-top: 5px;
    max-height: 400px;
    overflow-y: auto;
  }

  .search-result-item {
    padding: 15px;
    border-bottom: 1px solid #eee;
    cursor: pointer;
    display: flex;
    flex-direction: column;
    transition: background-color 0.2s ease;
  }

  .search-result-item:last-child {
    border-bottom: none;
  }

  .search-result-item:hover {
    background-color: #f8f9fa;
  }

  .search-result-item h4 {
    margin: 0 0 5px 0;
    color: #1a73e8;
    font-size: 18px;
    font-weight: 500;
  }

  .search-result-item .category {
    color: #70757a;
    font-size: 12px;
    margin-bottom: 5px;
  }

  .search-result-item .content-preview {
    margin: 5px 0;
    color: #4d5156;
    font-size: 14px;
    line-height: 1.58;
  }

  .search-result-meta {
    display: flex;
    justify-content: space-between;
    margin-top: 5px;
    font-size: 12px;
    color: #70757a;
  }

  .keyword-highlight {
    background-color: #ffeaa7;
    font-weight: bold;
    padding: 0 2px;
  }

  .no-results-message {
    padding: 20px;
    text-align: center;
    color: #4d5156;
    font-size: 16px;
  }

  /* 分页样式 */
  .search-pagination {
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 15px;
    border-top: 1px solid #eee;
  }

  .search-pagination button {
    margin: 0 5px;
    padding: 5px 10px;
    background: #f8f9fa;
    border: 1px solid #dadce0;
    border-radius: 4px;
    color: #520049;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .search-pagination button:hover {
    background: #e8f0fe;
    border-color: #520049;
  }

  .search-pagination button.active {
    background: #520049;
    color: white;
    border-color: #520049;
  }

  /* 导航栏样式 */
  .nav-link-1 {
    font-size: 20px !important;
    color: #ffffff !important;
    text-decoration: none;
    padding: 15px 15px 5px 5px;
    line-height: 30px;
    transition: color 0.3s ease;
  }

  .nav-link-1:hover {
    color: #520049 !important;
    text-decoration: none;
  }

  /* 下拉菜单样式 */
  .dropdown {
    position: relative;
  }
  
  .dropdown-toggle {
    cursor: pointer;
  }

  .dropdown-toggle:focus {
    outline: none;
  }
  
  /* 修复焦点状态问题 */
  .dropdown-toggle:not(:hover):not(.open) {
    color: #ffffff !important;
    background-color: transparent !important;
  }
  
  /* 确保按钮鼠标移走时会恢复原状 */
  .nav-link-1:not(:hover):not(.open) {
    color: #ffffff !important;
    background-color: transparent !important;
  }
  
  .caret {
    display: inline-block;
    width: 0;
    height: 0;
    margin-left: 5px;
    vertical-align: middle;
    border-top: 4px solid;
    border-right: 4px solid transparent;
    border-left: 4px solid transparent;
    transition: transform 0.3s ease;
  }
  
  .dropdown.open .caret {
    transform: rotate(180deg);
  }
  
  .dropdown-menu {
    position: absolute;
    top: 100%;
    left: 0;
    z-index: 1000;
    display: none;
    float: left;
    min-width: 160px;
    padding: 8px 0;
    margin: 2px 0 0;
    font-size: 16px;
    text-align: left;
    list-style: none;
    background-color: #ffffff;
    border: 1px solid rgba(0, 0, 0, .15);
    border-radius: 6px;
    box-shadow: 0 6px 12px rgba(0, 0, 0, .175);
    opacity: 0;
    transform: translateY(-10px);
    transition: all 0.3s ease;
  }
  
  .dropdown.open .dropdown-menu {
    display: block;
    opacity: 1;
    transform: translateY(0);
  }
  
  .dropdown-menu > li > a {
    display: block;
    padding: 10px 20px;
    color: #333;
    text-decoration: none;
    font-size: 16px;
    transition: all 0.3s ease;
        }

  .dropdown-menu > li > a:hover {
    color: #520049;
    background-color: #f5f5f5;
    text-decoration: none;
  }

  /* 下拉菜单状态控制 */
  .dropdown.open > .nav-link-1 {
    color: #520049 !important;
    text-decoration: none;
  }
  
  .dropdown:not(.open) > .nav-link-1:not(:hover) {
    color: #ffffff !important;
  }

  /* 修复导航栏底部间距，否则这是一个默认的逻辑22px */
  .navbar {
    margin-bottom: 0 !important;
}

  /* Logo样式 */
  .navbar-brand {
    display: flex;
    align-items: center;
    transition: all 0.3s ease;
  }
  
  .navbar-brand img {
    transition: all 0.3s ease;
  }
  
  /* 响应式设计 */
  @media (max-width: 1200px) {
    .navbar-brand img {
      max-height: 40px;
    }
    
    .nav-link-1 {
      font-size: 16px !important;
      padding: 10px 8px !important;
    }

    .dropdown-menu {
      position: static;
      display: none;
      float: none;
      width: auto;
      margin-top: 0;
      background-color: rgba(0, 0, 0, 0.1);
      border: 0;
      box-shadow: none;
      border-radius: 0;
    }
    
    .dropdown.open .dropdown-menu {
      display: block;
      opacity: 1;
      transform: none;
    }
    
    .dropdown-menu > li > a {
      padding: 8px 20px;
      color: #ffffff;
    }
    
    .dropdown-menu > li > a:hover {
      color: #520049;
      background-color: rgba(255, 255, 255, 0.1);
    }
    
    /* 外部导航栏响应式 */
    .navbar-toggler.external-toggler {
      display: block !important;
      z-index: 1001;
      background: transparent;
      border: none;
      cursor: pointer;
      position: absolute;
      right: 10px;
      top: 3px;
    }
    
    .external-nav {
      display: none;
      position: absolute;
      top: 30px;
      right: 0;
      background-color: #333333;
      z-index: 1010;
      width: 200px;
      height: auto !important;
      padding: 10px 0;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }
    
    .external-nav.show {
      display: block;
      position: absolute;
      max-height: calc(100vh - 50px);
      overflow-y: auto;
    }
    
    .external-nav li {
      display: block;
      width: 100%;
    }
    
    .external-nav li a {
      display: block !important;
      padding: 8px 15px !important;
      line-height: 20px !important;
    }
    
    /* 内部导航栏响应式 */
    .navbar-toggle.internal-toggler {
      display: block !important;
      margin-right: 0;
      margin-top: 0;
      border: 1px solid rgba(255,255,255,0.5);
      padding: 7px 10px;
      position: absolute;
      right: 10px;
      top: 10px;
      z-index: 1001;
    }
    
    .navbar-toggle.internal-toggler .icon-bar {
      display: block;
      width: 22px;
      height: 2px;
      background-color: #fff;
      margin: 4px 0;
    }
    
    #navbar-collapse-1 {
      position: absolute;
      top: 50px;
      left: 0;
      right: 0;
      background-color: #520049;
      z-index: 1000;
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease;
    }
    
    #navbar-collapse-1.show {
      max-height: 500px;
    }
    
    #navbar-collapse-1 ul.navbar-nav {
      margin: 0;
      padding: 10px 0;
      width: 100%;
    }
    
    #navbar-collapse-1 ul.navbar-nav > li {
      display: block;
      float: none;
      width: 100%;
    }
  }
  
  @media (max-width: 480px) {
    .navbar-brand img {
      max-height: 35px;
    }
    
    .nav-link-1 {
      font-size: 14px !important;
      padding: 8px 6px !important;
    }
  }
</style>

<!-- JavaScript -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  // 搜索功能
  var searchInput = document.getElementById('search-box-header');
  var resultsContainer = document.getElementById('search-results-header');
  var searchButton = document.getElementById('search-button-header');

  if (searchInput && resultsContainer && searchButton) {
    // 搜索逻辑（简化版本）
    function performSearch() {
      var query = searchInput.value.trim();
      if (!query) {
        resultsContainer.style.display = 'none';
        return;
      }

      // 自动关闭导航菜单，避免冲突
      var externalNav = document.querySelector('.external-nav');
      if (externalNav && externalNav.classList.contains('show')) {
        externalNav.classList.remove('show');
      }

      // 显示加载状态
      resultsContainer.innerHTML = '<div class="no-results-message">正在搜索...</div>';
      resultsContainer.style.display = 'block';

      // 这里可以加入实际的搜索逻辑
      // 现在显示一个占位符消息
      setTimeout(function() {
        resultsContainer.innerHTML = '<div class="no-results-message">搜索功能需要配置search.json文件</div>';
      }, 500);
    }

    // 事件监听
    searchInput.addEventListener('input', performSearch);
    searchInput.addEventListener('focus', performSearch);
    searchButton.addEventListener('click', performSearch);
    searchInput.addEventListener('keyup', function(e) {
      if (e.key === 'Enter') performSearch();
    });

    // 点击其他地方关闭搜索结果
    document.addEventListener('click', function(e) {
      if (!searchInput.contains(e.target) && !resultsContainer.contains(e.target) && !searchButton.contains(e.target)) {
        resultsContainer.style.display = 'none';
      }
    });
  }

  // 下拉菜单控制
  var dropdowns = document.querySelectorAll('.dropdown');
  
  dropdowns.forEach(function(dropdown) {
    var toggle = dropdown.querySelector('.dropdown-toggle');
    var menu = dropdown.querySelector('.dropdown-menu');
    
    if (!toggle || !menu) return;
    
    // 点击下拉按钮
    toggle.addEventListener('click', function(e) {
      e.preventDefault();
      e.stopPropagation();
      
      // 关闭其他所有下拉菜单
      dropdowns.forEach(function(otherDropdown) {
        if (otherDropdown !== dropdown) {
          otherDropdown.classList.remove('open');
          var otherToggle = otherDropdown.querySelector('.dropdown-toggle');
          if (otherToggle) otherToggle.blur(); // 移除焦点
        }
      });
      
      // 切换当前下拉菜单
      dropdown.classList.toggle('open');
      
      // 如果下拉菜单关闭了，移除按钮的focus状态
      if (!dropdown.classList.contains('open')) {
        toggle.blur();
      }
    });
    
    // 鼠标悬停显示
    dropdown.addEventListener('mouseenter', function() {
      dropdowns.forEach(function(otherDropdown) {
        if (otherDropdown !== dropdown) {
          otherDropdown.classList.remove('open');
          var otherToggle = otherDropdown.querySelector('.dropdown-toggle');
          if (otherToggle) otherToggle.blur(); // 移除焦点
        }
      });
      dropdown.classList.add('open');
    });
    
    // 鼠标离开隐藏
    dropdown.addEventListener('mouseleave', function() {
      dropdown.classList.remove('open');
      if (toggle) toggle.blur(); // 关键：移除按钮焦点
    });
  });
  
  // 点击页面其他地方关闭所有下拉菜单
  document.addEventListener('click', function(e) {
    dropdowns.forEach(function(dropdown) {
      if (!dropdown.contains(e.target)) {
        dropdown.classList.remove('open');
        var toggle = dropdown.querySelector('.dropdown-toggle');
        if (toggle) {
          toggle.blur(); // 移除焦点
          toggle.classList.remove('focus'); // 移除可能的focus类
        }
      }
    });
  });
  
  // ESC键关闭下拉菜单
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
      dropdowns.forEach(function(dropdown) {
        dropdown.classList.remove('open');
        var toggle = dropdown.querySelector('.dropdown-toggle');
        if (toggle) {
          toggle.blur(); // 移除焦点
          toggle.classList.remove('focus'); // 移除可能的focus类
        }
      });
    }
  });
  
  // 响应式导航栏控制
  
  // 外部导航栏控制
  var externalToggler = document.querySelector('.navbar-toggler.external-toggler');
  var externalNav = document.querySelector('.external-nav');
  
  if (externalToggler && externalNav) {
    externalToggler.addEventListener('click', function(e) {
      e.stopPropagation(); // 阻止事件冒泡
      
      // 自动关闭搜索结果，避免冲突
      var searchResults = document.getElementById('search-results-header');
      if (searchResults && searchResults.style.display !== 'none') {
        searchResults.style.display = 'none';
      }
      
      externalNav.classList.toggle('show');
    });
    
    // 点击外部关闭菜单（增强版）
    document.addEventListener('click', function(e) {
      if (externalNav.classList.contains('show') && !externalNav.contains(e.target) && !externalToggler.contains(e.target)) {
        externalNav.classList.remove('show');
      }
    });
    
    // ESC键关闭菜单
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape' && externalNav.classList.contains('show')) {
        externalNav.classList.remove('show');
      }
    });
  }
  
  // 内部导航栏控制
  var internalToggler = document.querySelector('.navbar-toggle.internal-toggler');
  var navbarCollapse = document.getElementById('navbar-collapse-1');
  
  if (internalToggler && navbarCollapse) {
    internalToggler.addEventListener('click', function() {
      navbarCollapse.classList.toggle('show');
    });
    
    // 在小屏幕上，点击导航链接后关闭菜单
    var navLinks = navbarCollapse.querySelectorAll('.nav-link-1');
    navLinks.forEach(function(link) {
      link.addEventListener('click', function() {
        if (window.innerWidth <= 1200) {
          navbarCollapse.classList.remove('show');
      }
    });
  });
  }
  
  // 窗口大小改变时处理
  window.addEventListener('resize', function() {
    if (window.innerWidth > 1200) {
      // 重置外部导航栏
      if (externalNav) {
        externalNav.classList.remove('show');
      }
      
      // 重置内部导航栏
      if (navbarCollapse) {
        navbarCollapse.classList.remove('show');
      }
    }
  });
  });
</script>
